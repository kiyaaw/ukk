<?php
$koneksi = mysqli_connect ("localhost", "root", "", "ujikom_12rpl2_kiyaa");

// cek id dari url
if (!isset($_GET['id'])) {
    echo "Id pengaduan tidak ditemukan";
    exit;
}

$id = $_GET['id'];

// update data
if (isset($_POST['simpan'])) {
    $status = $_POST['status'];
    $feedback = $_POST['feedback'];

    mysqli_query($koneksi, "UPDATE `input-aspirasi` SET status='$status', feedback='$feedback' WHERE `id-pelaporan`='$id' ");

    header("Location: admin.php");
    exit;
}

// buat ngambil data
$query = mysqli_query($koneksi, "SELECT `input-aspirasi` .*, kategori.`ket-kategori` FROM `input-aspirasi` LEFT JOIN kategori ON `input-aspirasi`.`id-kategori` = kategori.`ket-kategori` WHERE `input-aspirasi`.`id-pengaduan` = '$id'");

$data = mysqli_fetch_assoc($query);

if (!$data) {
    echo "data pengaduan tidak ditemukan";
    exit;
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h2> Detail Pengaduan </h2>
    <form>
        <table>
            <tr>
                <td><b> Id pengaduan </b></td>
                <td><?= $data['id-pengaduan'] ?></td>
            </tr>
            <tr>
                <td><b> Kategori </b></td>
                <td><?= $data['ket-kategori'] ?></td>
            </tr>
            <tr>
                <td><b> Lokasi </b></td>
                <td><?= $data['lokasi'] ?></td>
            </tr>
            <tr>
                <td><b> Keterangan </b></td>
                <td><?= $data['ket'] ?></td>
            </tr>

            <!-- ubah status -->
            <tr>
                <td><b> Status </b></td>
                <td>
                    <select name="status">
                        <option value="Proses" <?= $data['status'] == 'Proses' ? 'selected' : ''?>>Proses</option>
                        <option value="Selesai" <?= $data['status'] == 'Proses' ? 'selesai' : ''?>>Selesai</option>
                    </select>
                </td>
            </tr>
            <!-- feedback -->
            <tr>
                <td><b>Feedback Admin</b></b>
                <td>
                    <textarea name="Feedback" rows="4" cols="40"><?= $data['feedback'] ?></textarea>
                </td> 
            </tr>
        </table>
        <br>
        <button type="submit" name="simpan"> simpan perubahan </button>
        <a href="admin.php">kembali</a>
    </form>
</body>
</html><?php
$koneksi = mysqli_connect ("localhost", "root", "", "ujikom_12rpl2_kiyaa");

// cek id dari url
if (!isset($_GET['id'])) {
    echo "Id pengaduan tidak ditemukan";
    exit;
}

$id = $_GET['id'];

// update data
if (isset($_POST['simpan'])) {
    $status = $_POST['status'];
    $feedback = $_POST['feedback'];

    mysqli_query($koneksi, "UPDATE `input-aspirasi` SET status='$status', feedback='$feedback' WHERE `id-pelaporan`='$id' ");

    header("Location: admin.php");
    exit;
}

// buat ngambil data
$query = mysqli_query($koneksi, "SELECT `input-aspirasi` .*, kategori.`ket-kategori` FROM `input-aspirasi` LEFT JOIN kategori ON `input-aspirasi`.`id-kategori` = kategori.`ket-kategori` WHERE `input-aspirasi`.`id-pengaduan` = '$id'");

$data = mysqli_fetch_assoc($query);

if (!$data) {
    echo "data pengaduan tidak ditemukan";
    exit;
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h2> Detail Pengaduan </h2>
    <form>
        <table>
            <tr>
                <td><b> Id pengaduan </b></td>
                <td><?= $data['id-pengaduan'] ?></td>
            </tr>
            <tr>
                <td><b> Kategori </b></td>
                <td><?= $data['ket-kategori'] ?></td>
            </tr>
            <tr>
                <td><b> Lokasi </b></td>
                <td><?= $data['lokasi'] ?></td>
            </tr>
            <tr>
                <td><b> Keterangan </b></td>
                <td><?= $data['ket'] ?></td>
            </tr>

            <!-- ubah status -->
            <tr>
                <td><b> Status </b></td>
                <td>
                    <select name="status">
                        <option value="Proses" <?= $data['status'] == 'Proses' ? 'selected' : ''?>>Proses</option>
                        <option value="Selesai" <?= $data['status'] == 'Proses' ? 'selesai' : ''?>>Selesai</option>
                    </select>
                </td>
            </tr>
            <!-- feedback -->
            <tr>
                <td><b>Feedback Admin</b></b>
                <td>
                    <textarea name="Feedback" rows="4" cols="40"><?= $data['feedback'] ?></textarea>
                </td> 
            </tr>
        </table>
        <br>
        <button type="submit" name="simpan"> simpan perubahan </button>
        <a href="admin.php">kembali</a>
    </form>
</body>
</html>
