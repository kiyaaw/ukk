<?php
$koneksi = mysqli_connect("localhost", "root", "", "ujikom_12rpl2_feby");

// cek id dari URL
if (!isset($_GET['id'])) {
    echo "Id pengaduan tidak ditemukan";
    exit;
}

$id = $_GET['id'];

// update data
if (isset($_POST['simpan'])) {
    $status = $_POST['status'];
    $feedback = $_POST['feedback'];

    mysqli_query($koneksi, "UPDATE `input-asprirasi`
    SET status='$status', feedback='$feedback'
    WHERE `id_pelaporan`='$id'");

    header("Location: admin.php");
    exit;
}

// ambil data
$query = mysqli_query($koneksi, "SELECT `input-asprirasi`.*, `kategori`.`ket_kategori`
FROM `input-asprirasi`
JOIN `kategori`
ON `input-asprirasi`.`kategori` = `kategori`.`ket_kategori`
WHERE `input-asprirasi`.`id_pelaporan` = '$id'");



$data = mysqli_fetch_assoc($query);

// jika data tidak ditemukan
if (!$data) {
    header("Location: dashboard-siswa.php");
    exit();
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h2> Detail Pengaduan #<?= $data['id_pelaporan']; ?></h2>
<hr>

<table cellpadding="8">
    <tr>
        <td><strong>NIS pelapor</strong></td>
        <td>: <?= $data['nis']; ?></td>
    </tr>
    <tr>
        <td><strong>Kategori</strong></td>
        <td>: <?= $data['ket_kategori']; ?></td>
    </tr>
    <tr>
        <td><strong>Lokasi</strong></td>
        <td>: <?= $data['lokasi']; ?></td>
    </tr>
    <tr>
        <td><strong>Isi Laporan</strong></td>
        <td>: <?= $data['ket']; ?></td>
    </tr>
    <tr>
        <td><strong>Status Saat Ini</strong></td>
        <td>: <span style="color:red;"><?= strtoupper($data['status']); ?></span></td>
    </tr>
    <tr>
        <td><strong>Tanggapan Admin</strong></td>
        <td>: <i><?= $data['feedback'] ? $data['feedback'] : "Belum ada respon dari admin"; ?></i></td>
    </tr>
</table>

<br>
<a href="data-pengaduan.php">Kembali ke daftar</a>

</body>
</html>

